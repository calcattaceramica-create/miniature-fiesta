# ğŸ’° Ù…ÙŠØ²Ø© Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹ (Complete Sale)

## ğŸ¯ Ø§Ù„Ù‡Ø¯Ù
ØªÙ…ÙƒÙŠÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ø´ÙƒÙ„ ÙƒØ§Ù…Ù„ ÙÙŠ Ø®Ø·ÙˆØ© ÙˆØ§Ø­Ø¯Ø©: Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©ØŒ ØªØ£ÙƒÙŠØ¯Ù‡Ø§ØŒ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†ØŒ ÙˆØªØ³Ø¬ÙŠÙ„Ù‡Ø§ ÙƒÙ…Ø¯ÙÙˆØ¹Ø©.

---

## âœ… Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…Ø¶Ø§ÙØ©

### 1ï¸âƒ£ **Ø²Ø± "Ø­ÙØ¸ ÙˆØ¥ØªÙ…Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹" ÙÙŠ ØµÙØ­Ø© Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ§ØªÙˆØ±Ø©**

ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø²Ø±ÙŠÙ† ÙÙŠ ØµÙØ­Ø© Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ§ØªÙˆØ±Ø©:

<augment_code_snippet path="app/templates/sales/add_invoice.html" mode="EXCERPT">
````html
<div>
    <button type="submit" name="action" value="save_draft" class="btn btn-primary me-2">
        <i class="fas fa-save"></i> {{ _('Save as Draft') }}
    </button>
    <button type="submit" name="action" value="complete_sale" class="btn btn-success">
        <i class="fas fa-check-double"></i> {{ _('Save & Complete Sale') }}
    </button>
</div>
````
</augment_code_snippet>

---

### 2ï¸âƒ£ **Ø²Ø± "Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹" ÙÙŠ ØµÙØ­Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©**

Ù„Ù„ÙÙˆØ§ØªÙŠØ± Ø¨Ø­Ø§Ù„Ø© "Ù…Ø³ÙˆØ¯Ø©"ØŒ ÙŠØ¸Ù‡Ø± Ø²Ø± Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹:

<augment_code_snippet path="app/templates/sales/invoice_details.html" mode="EXCERPT">
````html
{% if invoice.status == 'draft' %}
    <a href="{{ url_for('sales.complete_sale', id=invoice.id) }}" 
       class="btn btn-success w-100 mb-2">
        <i class="fas fa-check-double"></i> {{ _('Complete Sale') }}
    </a>
    <a href="{{ url_for('sales.confirm_invoice', id=invoice.id) }}" 
       class="btn btn-primary w-100 mb-2">
        <i class="fas fa-check"></i> {{ _('Confirm Invoice Only') }}
    </a>
{% endif %}
````
</augment_code_snippet>

---

### 3ï¸âƒ£ **Route Ø¬Ø¯ÙŠØ¯: complete_sale**

ØªÙ… Ø¥Ø¶Ø§ÙØ© route Ø¬Ø¯ÙŠØ¯ ÙŠÙ‚ÙˆÙ… Ø¨Ù€:

#### **Ø£. ØªØ£ÙƒÙŠØ¯ Ø§Ù„ÙØ§ØªÙˆØ±Ø©:**
```python
invoice.status = 'confirmed'
invoice.payment_status = 'paid'
invoice.paid_amount = invoice.total_amount
invoice.remaining_amount = 0
```

#### **Ø¨. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†:**
```python
for item in invoice.items:
    stock = Stock.query.filter_by(
        product_id=item.product_id,
        warehouse_id=invoice.warehouse_id
    ).first()
    
    # Check availability
    if stock.quantity < item.quantity:
        flash('Insufficient quantity', 'error')
        return
    
    # Reduce stock
    stock.quantity -= item.quantity
```

#### **Ø¬. ØªØ³Ø¬ÙŠÙ„ Ø­Ø±ÙƒØ© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†:**
```python
movement = StockMovement(
    product_id=item.product_id,
    warehouse_id=invoice.warehouse_id,
    movement_type='out',
    quantity=item.quantity,
    reference_type='sales_invoice',
    reference_id=invoice.id,
    notes=f'Ø¨ÙŠØ¹ Ù…ÙƒØªÙ…Ù„ - ÙØ§ØªÙˆØ±Ø© Ø±Ù‚Ù… {invoice.invoice_number}'
)
```

#### **Ø¯. Ø¥Ù†Ø´Ø§Ø¡ Ù‚ÙŠØ¯ Ù…Ø­Ø§Ø³Ø¨ÙŠ:**
```python
journal_entry = create_sales_invoice_journal_entry(invoice)
```

---

## ğŸ¬ ÙƒÙŠÙÙŠØ© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…

### **Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© 1: Ù…Ù† ØµÙØ­Ø© Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ§ØªÙˆØ±Ø©**

1. **Ø§ÙØªØ­ ØµÙØ­Ø© Ø¥Ø¶Ø§ÙØ© ÙØ§ØªÙˆØ±Ø©:**
   ```
   http://127.0.0.1:5000/sales/invoices/add
   ```

2. **Ø§Ù…Ù„Ø£ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø©:**
   - Ø§Ù„ØªØ§Ø±ÙŠØ®
   - Ø§Ù„Ø¹Ù…ÙŠÙ„
   - Ø§Ù„Ù…Ø®Ø²Ù†
   - Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª

3. **Ø§Ø®ØªØ± Ø£Ø­Ø¯ Ø§Ù„Ø®ÙŠØ§Ø±ÙŠÙ†:**
   - ğŸ”µ **"Ø­ÙØ¸ ÙƒÙ…Ø³ÙˆØ¯Ø©"** - ÙŠØ­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙÙ‚Ø·
   - ğŸŸ¢ **"Ø­ÙØ¸ ÙˆØ¥ØªÙ…Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹"** - ÙŠØ­ÙØ¸ ÙˆÙŠØªÙ… Ø§Ù„Ø¨ÙŠØ¹ Ù…Ø¨Ø§Ø´Ø±Ø©

4. **Ø¥Ø°Ø§ Ø§Ø®ØªØ±Øª "Ø­ÙØ¸ ÙˆØ¥ØªÙ…Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹":**
   - âœ… ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
   - âœ… ÙŠØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
   - âœ… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
   - âœ… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙƒÙ…Ø¯ÙÙˆØ¹Ø©
   - âœ… ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‚ÙŠØ¯ Ù…Ø­Ø§Ø³Ø¨ÙŠ

---

### **Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© 2: Ù…Ù† ØµÙØ­Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©**

1. **Ø§ÙØªØ­ ÙØ§ØªÙˆØ±Ø© Ø¨Ø­Ø§Ù„Ø© "Ù…Ø³ÙˆØ¯Ø©"**

2. **Ø§Ø¶ØºØ· Ø²Ø± "Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹"** ğŸŸ¢

3. **ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©:**
   - Ø³ØªØ¸Ù‡Ø± Ø±Ø³Ø§Ù„Ø©: "Ø¥ØªÙ…Ø§Ù… Ù‡Ø°Ø§ Ø§Ù„Ø¨ÙŠØ¹ØŸ Ø³ÙŠØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙˆØªØ³Ø¬ÙŠÙ„Ù‡Ø§ ÙƒÙ…Ø¯ÙÙˆØ¹Ø©"
   - Ø§Ø¶ØºØ· **"OK"** Ù„Ù„ØªØ£ÙƒÙŠØ¯

4. **Ø§Ù„Ù†ØªÙŠØ¬Ø©:**
   - âœ… Ø­Ø§Ù„Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©: **Confirmed**
   - âœ… Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹: **Paid**
   - âœ… Ø§Ù„Ù…Ø®Ø²ÙˆÙ†: **Ù…Ø­Ø¯Ù‘Ø«**
   - âœ… Ø§Ù„Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ: **Ù…ÙÙ†Ø´Ø£**

---

## ğŸ”„ Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª

### **1. Ø­ÙØ¸ ÙƒÙ…Ø³ÙˆØ¯Ø© (Save as Draft):**
```
Ø§Ù„ÙØ§ØªÙˆØ±Ø© â†’ Ø­Ø§Ù„Ø©: Draft
Ø§Ù„Ù…Ø®Ø²ÙˆÙ† â†’ Ù„Ø§ ØªØºÙŠÙŠØ±
Ø§Ù„Ø¯ÙØ¹ â†’ ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹Ø©
```

### **2. ØªØ£ÙƒÙŠØ¯ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙÙ‚Ø· (Confirm Invoice Only):**
```
Ø§Ù„ÙØ§ØªÙˆØ±Ø© â†’ Ø­Ø§Ù„Ø©: Confirmed
Ø§Ù„Ù…Ø®Ø²ÙˆÙ† â†’ ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« âœ…
Ø§Ù„Ø¯ÙØ¹ â†’ ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹Ø© (Ø¢Ø¬Ù„)
Ø±ØµÙŠØ¯ Ø§Ù„Ø¹Ù…ÙŠÙ„ â†’ ÙŠØ²ÙŠØ¯
```

### **3. Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹ (Complete Sale):**
```
Ø§Ù„ÙØ§ØªÙˆØ±Ø© â†’ Ø­Ø§Ù„Ø©: Confirmed
Ø§Ù„Ù…Ø®Ø²ÙˆÙ† â†’ ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« âœ…
Ø§Ù„Ø¯ÙØ¹ â†’ Ù…Ø¯ÙÙˆØ¹Ø© ÙƒØ§Ù…Ù„Ø§Ù‹ âœ…
Ø±ØµÙŠØ¯ Ø§Ù„Ø¹Ù…ÙŠÙ„ â†’ Ù„Ø§ ØªØºÙŠÙŠØ± (Ù†Ù‚Ø¯ÙŠ)
```

---

## ğŸ›¡ï¸ Ø§Ù„Ø­Ù…Ø§ÙŠØ© ÙˆØ§Ù„ØªØ­Ù‚Ù‚

### **1. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©:**
```python
if invoice.status != 'draft':
    flash('Cannot complete this sale', 'error')
    return
```

### **2. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙˆÙØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†:**
```python
if stock.quantity < item.quantity:
    flash(f'Insufficient quantity. Available: {stock.quantity}', 'error')
    db.session.rollback()
    return
```

### **3. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬ ÙÙŠ Ø§Ù„Ù…Ø®Ø²Ù†:**
```python
if not stock:
    flash(f'Product {item.product.name} not found in warehouse', 'error')
    db.session.rollback()
    return
```

### **4. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡:**
```python
try:
    # ... Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
    db.session.commit()
except Exception as e:
    db.session.rollback()
    flash(f'Error: {str(e)}', 'error')
```

---

## ğŸ“Š Ù…Ø«Ø§Ù„ Ø¹Ù…Ù„ÙŠ

### **Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ:**
Ø¹Ù…ÙŠÙ„ ÙŠØ´ØªØ±ÙŠ 3 Ù…Ù†ØªØ¬Ø§Øª Ù†Ù‚Ø¯Ø§Ù‹.

### **Ø§Ù„Ø®Ø·ÙˆØ§Øª:**

1. **Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙØ§ØªÙˆØ±Ø©:**
   ```
   Ø§Ù„Ø¹Ù…ÙŠÙ„: Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯
   Ø§Ù„Ù…Ø®Ø²Ù†: Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
   
   Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:
   - Ù„Ø§Ø¨ØªÙˆØ¨ Ã— 1 = 5000 Ø±ÙŠØ§Ù„
   - Ù…Ø§ÙˆØ³ Ã— 2 = 100 Ø±ÙŠØ§Ù„
   - ÙƒÙŠØ¨ÙˆØ±Ø¯ Ã— 1 = 150 Ø±ÙŠØ§Ù„
   
   Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 5250 Ø±ÙŠØ§Ù„
   ```

2. **Ø§Ø¶ØºØ· "Ø­ÙØ¸ ÙˆØ¥ØªÙ…Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹"** ğŸŸ¢

3. **Ø§Ù„Ù†ØªÙŠØ¬Ø©:**
   ```
   âœ… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: INV202601XXXX - Confirmed & Paid
   
   âœ… Ø§Ù„Ù…Ø®Ø²ÙˆÙ†:
      - Ù„Ø§Ø¨ØªÙˆØ¨: 10 â†’ 9
      - Ù…Ø§ÙˆØ³: 50 â†’ 48
      - ÙƒÙŠØ¨ÙˆØ±Ø¯: 20 â†’ 19
   
   âœ… Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†:
      - 3 Ø­Ø±ÙƒØ§Øª "Ø®Ø±ÙˆØ¬" Ù…Ø³Ø¬Ù„Ø©
   
   âœ… Ø§Ù„Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ:
      - Ù…Ù† Ø­/ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚: 5250 Ø±ÙŠØ§Ù„
      - Ø¥Ù„Ù‰ Ø­/ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª: 5250 Ø±ÙŠØ§Ù„
   ```

---

## ğŸ¨ Ø§Ù„ØªØµÙ…ÙŠÙ…

### **Ø§Ù„Ø£Ø²Ø±Ø§Ø±:**

| Ø§Ù„Ø²Ø± | Ø§Ù„Ù„ÙˆÙ† | Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© | Ø§Ù„ÙˆØ¸ÙŠÙØ© |
|------|-------|----------|---------|
| Ø­ÙØ¸ ÙƒÙ…Ø³ÙˆØ¯Ø© | Ø£Ø²Ø±Ù‚ (Primary) | ğŸ’¾ fa-save | Ø­ÙØ¸ ÙÙ‚Ø· |
| Ø­ÙØ¸ ÙˆØ¥ØªÙ…Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹ | Ø£Ø®Ø¶Ø± (Success) | âœ… fa-check-double | Ø­ÙØ¸ + ØªØ£ÙƒÙŠØ¯ + Ø¯ÙØ¹ |
| Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹ | Ø£Ø®Ø¶Ø± (Success) | âœ… fa-check-double | ØªØ£ÙƒÙŠØ¯ + Ø¯ÙØ¹ |
| ØªØ£ÙƒÙŠØ¯ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙÙ‚Ø· | Ø£Ø²Ø±Ù‚ (Primary) | âœ”ï¸ fa-check | ØªØ£ÙƒÙŠØ¯ ÙÙ‚Ø· |

---

**ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ†ÙÙŠØ°:** 2026-01-14  
**Ø§Ù„Ø­Ø§Ù„Ø©:** âœ… **Ù…ÙƒØªÙ…Ù„ ÙˆØ¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…**

