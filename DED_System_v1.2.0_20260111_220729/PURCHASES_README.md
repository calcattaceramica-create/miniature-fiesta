# نظام المشتريات - دليل سريع

## ما تم إنجازه ✅

### 1. المسارات (Routes)
تم إضافة المسارات التالية في `app/purchases/routes.py`:

- ✅ `/purchases/suppliers` - قائمة الموردين
- ✅ `/purchases/suppliers/add` - إضافة مورد جديد
- ✅ `/purchases/invoices` - قائمة فواتير الشراء
- ✅ `/purchases/invoices/add` - إضافة فاتورة جديدة
- ✅ `/purchases/invoices/<id>` - تفاصيل الفاتورة
- ✅ `/purchases/invoices/<id>/confirm` - تأكيد الفاتورة
- ✅ `/purchases/invoices/<id>/cancel` - إلغاء الفاتورة
- ✅ `/purchases/invoices/<id>/delete` - حذف الفاتورة (مسودة فقط)

### 2. الواجهات (Templates)
تم إنشاء الواجهات التالية في `app/templates/purchases/`:

- ✅ `suppliers.html` - قائمة الموردين مع البحث والترقيم
- ✅ `add_supplier.html` - نموذج إضافة مورد جديد
- ✅ `invoices.html` - قائمة فواتير الشراء مع التصفية
- ✅ `add_invoice.html` - نموذج إضافة فاتورة مع حسابات تلقائية
- ✅ `invoice_details.html` - عرض تفاصيل الفاتورة
- ✅ `confirm_invoice.html` - تأكيد الفاتورة
- ✅ `cancel_invoice.html` - إلغاء الفاتورة
- ✅ `delete_invoice.html` - حذف الفاتورة

### 3. القائمة الرئيسية
تم تحديث `app/templates/base.html`:
- ✅ تحويل رابط المشتريات إلى قائمة منسدلة
- ✅ إضافة روابط سريعة لجميع الوظائف

### 4. الوظائف الرئيسية

#### إدارة الموردين
- ✅ عرض قائمة الموردين مع الأرصدة
- ✅ البحث في الموردين
- ✅ إضافة مورد جديد بجميع التفاصيل
- ✅ تتبع رصيد كل مورد

#### فواتير الشراء
- ✅ إنشاء فاتورة شراء بحالة "مسودة"
- ✅ إضافة أصناف متعددة للفاتورة
- ✅ حساب تلقائي للضرائب والخصومات
- ✅ تأكيد الفاتورة وإضافة المخزون
- ✅ إلغاء الفاتورة وخصم المخزون
- ✅ حذف الفواتير في حالة المسودة
- ✅ عرض تفاصيل كاملة لكل فاتورة

#### ربط المخزون
- ✅ إضافة تلقائية للكميات عند التأكيد
- ✅ خصم تلقائي للكميات عند الإلغاء
- ✅ تسجيل حركات المخزون لكل عملية
- ✅ ربط كل حركة بالفاتورة المرجعية

#### الحسابات
- ✅ تحديث رصيد المورد تلقائياً
- ✅ تتبع المبالغ المدفوعة والمتبقية
- ✅ حالات الدفع (غير مدفوعة، جزئية، مدفوعة)

### 5. المميزات الإضافية
- ✅ واجهات عربية كاملة
- ✅ تصميم متجاوب (Responsive)
- ✅ رسائل تأكيد للعمليات الحساسة
- ✅ تنبيهات واضحة للمستخدم
- ✅ حسابات JavaScript تلقائية في نموذج الفاتورة
- ✅ ترقيم الصفحات (Pagination)
- ✅ البحث والتصفية

## كيفية الاستخدام

### 1. تشغيل التطبيق
```bash
python run.py
```

### 2. الوصول للنظام
افتح المتصفح على: `http://localhost:5000`

### 3. إضافة مورد
1. اذهب إلى **المشتريات > الموردين**
2. اضغط **إضافة مورد جديد**
3. املأ البيانات واحفظ

### 4. إنشاء فاتورة شراء
1. اذهب إلى **المشتريات > فاتورة جديدة**
2. اختر المورد والمستودع
3. أضف الأصناف
4. احفظ الفاتورة (ستكون مسودة)

### 5. تأكيد الفاتورة
1. افتح الفاتورة من القائمة
2. اضغط **تأكيد الفاتورة**
3. راجع التغييرات وأكد
4. سيتم إضافة الكميات للمخزون تلقائياً

## الملفات المهمة

```
app/
├── purchases/
│   ├── __init__.py
│   └── routes.py          # جميع المسارات والوظائف
├── templates/
│   ├── purchases/
│   │   ├── suppliers.html
│   │   ├── add_supplier.html
│   │   ├── invoices.html
│   │   ├── add_invoice.html
│   │   ├── invoice_details.html
│   │   ├── confirm_invoice.html
│   │   ├── cancel_invoice.html
│   │   └── delete_invoice.html
│   └── base.html          # القائمة الرئيسية المحدثة
└── models.py              # النماذج (موجودة مسبقاً)

PURCHASES_DOCUMENTATION.md  # التوثيق الشامل
PURCHASES_README.md         # هذا الملف
```

## حالات الفاتورة

| الحالة | الوصف | الإجراءات المتاحة |
|--------|-------|-------------------|
| مسودة | فاتورة محفوظة غير مؤكدة | تأكيد، تعديل، حذف |
| مؤكدة | تم إضافة المخزون | إلغاء، عرض، طباعة |
| مدفوعة | تم الدفع كاملاً | عرض، طباعة |
| ملغاة | تم إلغاء الفاتورة | عرض فقط |

## التحديثات المستقبلية المقترحة

- [ ] تعديل فاتورة في حالة المسودة
- [ ] تعديل بيانات المورد
- [ ] تقارير المشتريات
- [ ] تصدير الفواتير PDF
- [ ] إضافة مرفقات للفواتير
- [ ] سجل الدفعات للموردين
- [ ] تنبيهات للفواتير المستحقة
- [ ] مقارنة أسعار الموردين

## ملاحظات مهمة

⚠️ **تنبيهات**:
- لا يمكن حذف فاتورة مؤكدة، يمكن إلغاؤها فقط
- عند إلغاء فاتورة، تأكد من وجود كميات كافية في المخزون
- رصيد المورد يتحدث تلقائياً مع كل عملية

✅ **نصائح**:
- استخدم حالة المسودة للفواتير قيد المراجعة
- راجع جميع البيانات قبل التأكيد
- احتفظ بنسخ احتياطية من قاعدة البيانات

## الدعم

للمزيد من التفاصيل، راجع ملف `PURCHASES_DOCUMENTATION.md`

---

**تم التطوير بواسطة**: نظام إدارة المخزون
**التاريخ**: 2026-01-10
**الإصدار**: 1.0

