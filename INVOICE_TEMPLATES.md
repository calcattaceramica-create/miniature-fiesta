# قوالب الفواتير وعروض الأسعار

## نظرة عامة
تم تطبيق نظام قوالب ديناميكية للفواتير وعروض الأسعار و**نسبة ضريبة مخصصة** يسمح بتخصيص مظهر الفواتير ونسبة الضريبة بناءً على إعدادات الشركة.

### الميزات الجديدة:
- ✅ **قوالب ديناميكية**: 4 قوالب مختلفة للاختيار من بينها
- ✅ **نسبة ضريبة مخصصة**: يمكنك تحديد نسبة الضريبة الخاصة بشركتك
- ✅ **تطبيق تلقائي**: يتم تطبيق الإعدادات تلقائياً على جميع الفواتير وعروض الأسعار ونقطة البيع

## القوالب المتاحة

### 1. Modern (افتراضي)
- **الألوان**: بنفسجي وأرجواني (#667eea, #764ba2)
- **الخصائص**: 
  - تدرجات لونية حديثة
  - حواف مستديرة
  - ظلال ناعمة
  - مناسب للشركات التقنية والحديثة

### 2. Classic
- **الألوان**: أخضر (#28a745, #20c997)
- **الخصائص**:
  - تصميم كلاسيكي احترافي
  - خلفية رمادية فاتحة
  - حواف مستديرة متوسطة
  - مناسب للشركات التقليدية

### 3. Minimal
- **الألوان**: أزرق فاتح (#17a2b8)
- **الخصائص**:
  - تصميم بسيط ونظيف
  - بدون تدرجات لونية
  - حواف حادة
  - مناسب للشركات التي تفضل البساطة

### 4. Elegant
- **الألوان**: وردي وأحمر (#f093fb, #f5576c)
- **الخصائص**:
  - تصميم أنيق وجذاب
  - تأثيرات بصرية متقدمة
  - حواف مستديرة جداً
  - مناسب للشركات الإبداعية والفاخرة

## كيفية الاستخدام

### 1. تعيين القالب ونسبة الضريبة للشركة
في إعدادات الشركة، قم بتعيين الحقول التالية:

#### أ. قالب الفاتورة (`invoice_template`)
- `modern` (افتراضي)
- `classic`
- `minimal`
- `elegant`

#### ب. نسبة الضريبة (`tax_rate`)
- القيمة الافتراضية: `15.0` (15%)
- يمكنك تغييرها إلى أي نسبة تناسب شركتك
- مثال: `5.0` (5%)، `10.0` (10%)، `15.0` (15%)، `20.0` (20%)
- **ملاحظة**: يتم تطبيق النسبة تلقائياً على جميع الفواتير وعروض الأسعار ونقطة البيع

### 2. الملفات المتأثرة
- **الفواتير**: `app/templates/pos/receipt.html` + `app/templates/pos/receipt_styles.html`
- **عروض الأسعار**: `app/templates/pos/quotation.html` + `app/templates/pos/quotation_styles.html`
- **واجهة نقطة البيع**: `app/templates/pos/index.html` + `app/templates/pos/pos_styles.html`

### 3. البنية التقنية

#### أ. القوالب الديناميكية
- تم فصل الأنماط الثابتة عن الأنماط الديناميكية
- الأنماط الديناميكية يتم تحميلها من ملفات منفصلة
- يتم اختيار القالب بناءً على `company.invoice_template`

#### ب. نسبة الضريبة الديناميكية
- يتم قراءة نسبة الضريبة من `company.tax_rate`
- يتم تطبيقها تلقائياً في:
  - **نقطة البيع**: `const TAX_RATE = {{ (company.tax_rate / 100) if company and company.tax_rate else 0.15 }}`
  - **عرض النسبة**: `الضريبة ({{ company.tax_rate if company and company.tax_rate else 15 }}%)`
  - **الحسابات**: يتم استخدام النسبة في جميع حسابات الضريبة

## التخصيص

### إضافة قالب جديد
1. افتح `app/templates/pos/receipt_styles.html` و `app/templates/pos/quotation_styles.html`
2. أضف قسم جديد باستخدام `{% elif template == 'new_template' %}`
3. حدد الأنماط المخصصة للقالب الجديد

### تعديل قالب موجود
1. افتح الملف المناسب (`receipt_styles.html` أو `quotation_styles.html`)
2. ابحث عن القسم الخاص بالقالب
3. عدل الأنماط حسب الحاجة

## ملاحظات مهمة
- القالب الافتراضي هو `modern` إذا لم يتم تحديد قالب
- نسبة الضريبة الافتراضية هي `15.0%` إذا لم يتم تحديد نسبة
- جميع القوالب تحافظ على نفس البنية الأساسية
- التغييرات تؤثر فقط على المظهر وليس على المحتوى
- القوالب متوافقة مع الطباعة
- نسبة الضريبة تطبق تلقائياً على جميع الفواتير وعروض الأسعار ونقطة البيع

## الاختبار

### اختبار القوالب
1. قم بتغيير `invoice_template` في إعدادات الشركة
2. افتح فاتورة أو عرض سعر أو نقطة البيع
3. تحقق من تطبيق الألوان والأنماط الصحيحة

### اختبار نسبة الضريبة
1. اذهب إلى **الإعدادات** → **إعدادات الشركة**
2. غير حقل **نسبة الضريبة** (`tax_rate`) إلى القيمة المطلوبة (مثلاً: `5.0` أو `10.0`)
3. احفظ التغييرات
4. افتح نقطة البيع وأضف منتجات إلى السلة
5. تحقق من أن النسبة المعروضة تطابق النسبة المحددة في الإعدادات
6. تحقق من أن الحسابات صحيحة

## أمثلة على الاستخدام

### مثال 1: تغيير القالب إلى Classic
```python
company = Company.query.first()
company.invoice_template = 'classic'
db.session.commit()
```

### مثال 2: تغيير نسبة الضريبة إلى 5%
```python
company = Company.query.first()
company.tax_rate = 5.0
db.session.commit()
```

### مثال 3: تغيير القالب والضريبة معاً
```python
company = Company.query.first()
company.invoice_template = 'elegant'
company.tax_rate = 10.0
db.session.commit()
```

