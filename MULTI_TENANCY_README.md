# ๐ข Multi-Tenancy System - ูุธุงู ุงูุชุนุฏุฏูุฉ

## ๐ ูุธุฑุฉ ุนุงูุฉ | Overview

ุชู ุชุญููู ุงููุธุงู ุฅูู **ูุธุงู ูุชุนุฏุฏ ุงูุชุฑุงุฎูุต (Multi-Tenancy)** ุญูุซ:
- **ูู ุชุฑุฎูุต ูู ูุงุนุฏุฉ ุจูุงูุงุช ูููุตูุฉ ุชูุงูุงู**
- **ุนุฒู ูุงูู ููุจูุงูุงุช ุจูู ุงูุนููุงุก**
- **ุฃูุงู ุนุงูู ูุฎุตูุตูุฉ ุชุงูุฉ**

The system has been converted to a **Multi-Tenancy System** where:
- **Each license has a completely separate database**
- **Complete data isolation between clients**
- **High security and full privacy**

---

## ๐๏ธ ุงููุนูุงุฑูุฉ | Architecture

### ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฑุฆูุณูุฉ | Master Database
```
licenses_master.db
โโโ licenses (ุฌุฏูู ุงูุชุฑุงุฎูุต ููุท)
โโโ ูุญุชูู ุนูู ูุนูููุงุช ุฌููุน ุงูุชุฑุงุฎูุต
```

### ููุงุนุฏ ุจูุงูุงุช ุงูุนููุงุก | Tenant Databases
```
tenant_databases/
โโโ tenant_9813_26D0_F98D_741C.db  (ุนููู 1)
โโโ tenant_XXXX_XXXX_XXXX_XXXX.db  (ุนููู 2)
โโโ tenant_YYYY_YYYY_YYYY_YYYY.db  (ุนููู 3)
```

ูู ูุงุนุฏุฉ ุจูุงูุงุช ุนููู ุชุญุชูู ุนูู:
- ุงููุณุชุฎุฏููู (Users)
- ุงูููุชุฌุงุช (Products)
- ุงููุจูุนุงุช (Sales)
- ุงููุดุชุฑูุงุช (Purchases)
- ุงูุญุณุงุจุงุช (Accounting)
- ูุฌููุน ุงูุจูุงูุงุช ุงูุฃุฎุฑู

---

## ๐ ุงูุฅุนุฏุงุฏ | Setup

### 1๏ธโฃ ุชุดุบูู ุณูุฑูุจุช ุงูุฅุนุฏุงุฏ
```bash
python setup_multi_tenancy.py
```

ูุฐุง ุงูุณูุฑูุจุช ุณูููู ุจู:
- โ ุฅูุดุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฑุฆูุณูุฉ
- โ ููู ุงูุชุฑุงุฎูุต ุงูููุฌูุฏุฉ
- โ ุฅูุดุงุก ููุงุนุฏ ุจูุงูุงุช ูููุตูุฉ ููู ุชุฑุฎูุต
- โ ุชููุฆุฉ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ ููู ุนููู

---

## ๐ ุขููุฉ ุชุณุฌูู ุงูุฏุฎูู | Login Flow

### ุงูุฎุทูุงุช:
1. **ุงููุณุชุฎุฏู ูุฏุฎู:**
   - ุงุณู ุงููุณุชุฎุฏู (Username)
   - ูููุฉ ุงููุฑูุฑ (Password)
   - ููุชุงุญ ุงูุชุฑุฎูุต (License Key)

2. **ุงููุธุงู ูุชุญูู ูู:**
   - ุตุญุฉ ููุชุงุญ ุงูุชุฑุฎูุต ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฑุฆูุณูุฉ
   - ุญุงูุฉ ุงูุชุฑุฎูุต (ูุดุทุ ูุนููุ ููุชูู)

3. **ุงููุธุงู ูููู ุจู:**
   - ุงูุชุจุฏูู ุฅูู ูุงุนุฏุฉ ุจูุงูุงุช ุงูุนููู
   - ุงูุชุญูู ูู ุจูุงูุงุช ุงููุณุชุฎุฏู
   - ุชุณุฌูู ุงูุฏุฎูู

4. **ุทูุงู ุงูุฌูุณุฉ:**
   - ุฌููุน ุงูุนูููุงุช ุชุชู ุนูู ูุงุนุฏุฉ ุจูุงูุงุช ุงูุนููู ููุท
   - ุนุฒู ูุงูู ุนู ุจูุงูุงุช ุงูุนููุงุก ุงูุขุฎุฑูู

---

## ๐ ุงููููุงุช ุงูุฌุฏูุฏุฉ | New Files

### 1. `app/tenant_manager.py`
ูุฏูุฑ ููุงุนุฏ ุงูุจูุงูุงุช ุงููุชุนุฏุฏุฉ - ูุญุชูู ุนูู:
- `create_tenant_database()` - ุฅูุดุงุก ูุงุนุฏุฉ ุจูุงูุงุช ุฌุฏูุฏุฉ
- `initialize_tenant_data()` - ุชููุฆุฉ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ
- `switch_tenant_database()` - ุงูุชุจุฏูู ุจูู ููุงุนุฏ ุงูุจูุงูุงุช
- `backup_tenant_database()` - ูุณุฎ ุงุญุชูุงุทู
- `delete_tenant_database()` - ุญุฐู ูุงุนุฏุฉ ุจูุงูุงุช

### 2. `app/tenant_middleware.py`
Middleware ููุชุนุงูู ุงูุชููุงุฆู ูุน ุงูุชุจุฏูู ุจูู ููุงุนุฏ ุงูุจูุงูุงุช

### 3. `app/auth/multi_tenant_login.py`
ูุนุงูุฌ ุชุณุฌูู ุงูุฏุฎูู ูููุธุงู ูุชุนุฏุฏ ุงูุชุฑุงุฎูุต

### 4. `setup_multi_tenancy.py`
ุณูุฑูุจุช ุงูุฅุนุฏุงุฏ ุงูุฃููู ูููุธุงู

---

## ๐ง ุงูุงุณุชุฎุฏุงู | Usage

### ุฅูุดุงุก ุชุฑุฎูุต ุฌุฏูุฏ
```python
from app.tenant_manager import TenantManager
from app.models_license import License

# 1. ุฅูุดุงุก ุงูุชุฑุฎูุต ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฑุฆูุณูุฉ
license = License(
    license_key='XXXX-XXXX-XXXX-XXXX',
    client_name='ุงุณู ุงูุนููู',
    # ... ุจุงูู ุงูุจูุงูุงุช
)
db.session.add(license)
db.session.commit()

# 2. ุฅูุดุงุก ูุงุนุฏุฉ ุจูุงูุงุช ููุนููู
TenantManager.create_tenant_database(license.license_key, app)

# 3. ุชููุฆุฉ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ
TenantManager.initialize_tenant_data(license.license_key, app, license)
```

### ุงูุชุจุฏูู ุฅูู ูุงุนุฏุฉ ุจูุงูุงุช ุนููู
```python
from app.tenant_manager import TenantManager

# ุงูุชุจุฏูู ุฅูู ูุงุนุฏุฉ ุจูุงูุงุช ุนููู ูุนูู
TenantManager.switch_tenant_database(app, 'XXXX-XXXX-XXXX-XXXX')

# ุงูุขู ุฌููุน ุงูุนูููุงุช ุณุชุชู ุนูู ูุงุนุฏุฉ ุจูุงูุงุช ูุฐุง ุงูุนููู
users = User.query.all()  # ูุณุชุฎุฏูู ูุฐุง ุงูุนููู ููุท
```

### ูุณุฎ ุงุญุชูุงุทู ููุงุนุฏุฉ ุจูุงูุงุช ุนููู
```python
from app.tenant_manager import TenantManager

# ุฅูุดุงุก ูุณุฎุฉ ุงุญุชูุงุทูุฉ
backup_path = TenantManager.backup_tenant_database('XXXX-XXXX-XXXX-XXXX')
print(f"Backup created at: {backup_path}")
```

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ | Important Notes

### 1. ุนุฒู ุงูุจูุงูุงุช
- โ ูู ุนููู ูู ูุงุนุฏุฉ ุจูุงูุงุช ูููุตูุฉ ุชูุงูุงู
- โ ูุง ูููู ูุนููู ุงููุตูู ุฅูู ุจูุงูุงุช ุนููู ุขุฎุฑ
- โ ุญุชู ูู ุญุงูุฉ ุงุฎุชุฑุงู ุญุณุงุจุ ุงูุจูุงูุงุช ูุญููุฉ

### 2. ุงูุฃุฏุงุก
- โ ูู ูุงุนุฏุฉ ุจูุงูุงุช ุตุบูุฑุฉ ููุณุชููุฉ
- โ ุฃุฏุงุก ุฃูุถู ูู ูุงุนุฏุฉ ุจูุงูุงุช ูุงุญุฏุฉ ูุจูุฑุฉ
- โ ุณูููุฉ ูู ุงููุณุฎ ุงูุงุญุชูุงุทู ูุงูุงุณุชุนุงุฏุฉ

### 3. ุงูุตูุงูุฉ
- โ ูููู ุนูู ุตูุงูุฉ ูุนููู ูุงุญุฏ ุฏูู ุงูุชุฃุซูุฑ ุนูู ุงูุขุฎุฑูู
- โ ูููู ุญุฐู ุจูุงูุงุช ุนููู ุจุณูููุฉ
- โ ูููู ููู ุจูุงูุงุช ุนููู ุฅูู ุฎุงุฏู ุขุฎุฑ

---

## ๐ ุงูุชุญุฏูุซุงุช ุงููุทููุจุฉ | Required Updates

### ูู `app/__init__.py`
```python
# ุฅุถุงูุฉ tenant middleware
from app.tenant_middleware import init_tenant_middleware
init_tenant_middleware(app)
```

### ูู `app/auth/routes.py`
```python
# ุงุณุชุฎุฏุงู multi_tenant_login
from app.auth.multi_tenant_login import authenticate_with_license

@bp.route('/login', methods=['GET', 'POST'])
def login():
    if request.method == 'POST':
        username = request.form.get('username')
        password = request.form.get('password')
        license_key = request.form.get('license_key')
        
        success, message, user = authenticate_with_license(
            username, password, license_key, current_app._get_current_object()
        )
        
        if success:
            login_user(user)
            return redirect(url_for('main.index'))
        else:
            flash(message, 'danger')
            return redirect(url_for('auth.login'))
```

---

## ๐ ุงูููุงุฆุฏ | Benefits

### 1. ุงูุฃูุงู ๐
- ุนุฒู ูุงูู ููุจูุงูุงุช
- ูุง ูููู ุงููุตูู ูุจูุงูุงุช ุนููู ุขุฎุฑ
- ุญูุงูุฉ ูู SQL Injection ุจูู ุงูุนููุงุก

### 2. ุงูุฃุฏุงุก โก
- ููุงุนุฏ ุจูุงูุงุช ุตุบูุฑุฉ = ุงุณุชุนูุงูุงุช ุฃุณุฑุน
- ูุง ุชุฃุซูุฑ ุจูู ุงูุนููุงุก
- ุณูููุฉ ุงูุชูุณุน

### 3. ุงููุฑููุฉ ๐ฏ
- ุฅููุงููุฉ ุชุฎุตูุต ูุงุนุฏุฉ ุจูุงูุงุช ูุนููู ูุนูู
- ุณูููุฉ ุงูููู ูุงููุณุฎ ุงูุงุญุชูุงุทู
- ุฅููุงููุฉ ุงูุญุฐู ุงููุงูู

---

## ๐ ุงูุฎูุงุตุฉ | Summary

ุงููุธุงู ุงูุขู **ุฌุงูุฒ ููุนูู ููุธุงู ูุชุนุฏุฏ ุงูุชุฑุงุฎูุต** ูุน:
- โ ูุงุนุฏุฉ ุจูุงูุงุช ุฑุฆูุณูุฉ ููุชุฑุงุฎูุต
- โ ููุงุนุฏ ุจูุงูุงุช ูููุตูุฉ ููู ุนููู
- โ ุขููุฉ ุชุณุฌูู ุฏุฎูู ูุญุฏุซุฉ
- โ Middleware ููุชุจุฏูู ุงูุชููุงุฆู
- โ ุฃุฏูุงุช ุฅุฏุงุฑุฉ ูุงููุฉ

**ูู ุชุฑุฎูุต ุงูุขู ูุณุชูู ุชูุงูุงู!** ๐

