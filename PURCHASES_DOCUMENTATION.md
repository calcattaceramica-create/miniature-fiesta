# دليل نظام المشتريات - نظام إدارة المخزون

## نظرة عامة

نظام المشتريات هو جزء أساسي من نظام إدارة المخزون، يتيح لك إدارة الموردين وفواتير الشراء بشكل كامل مع ربط تلقائي بالمخزون والحسابات.

## المميزات الرئيسية

### 1. إدارة الموردين
- إضافة وتعديل بيانات الموردين
- تصنيف الموردين (محلي، دولي، جملة، تجزئة)
- تتبع رصيد كل مورد
- حد ائتماني وشروط دفع لكل مورد
- معلومات ضريبية وتجارية كاملة

### 2. فواتير الشراء
- إنشاء فواتير شراء بحالة "مسودة"
- تأكيد الفواتير وإضافة المخزون تلقائياً
- إلغاء الفواتير المؤكدة مع خصم المخزون
- حذف الفواتير في حالة المسودة فقط
- حساب تلقائي للضرائب والخصومات
- ربط تلقائي مع المخزون والموردين

### 3. إدارة المخزون
- إضافة تلقائية للكميات عند تأكيد الفاتورة
- خصم تلقائي للكميات عند إلغاء الفاتورة
- تسجيل حركات المخزون لكل عملية
- ربط كل حركة بالفاتورة المرجعية

### 4. الحسابات
- تحديث رصيد المورد تلقائياً
- تتبع المبالغ المدفوعة والمتبقية
- حالات الدفع (غير مدفوعة، مدفوعة جزئياً، مدفوعة)

## دليل الاستخدام

### إضافة مورد جديد

1. انتقل إلى **المشتريات > الموردين**
2. اضغط على **إضافة مورد جديد**
3. املأ البيانات المطلوبة:
   - **المعلومات الأساسية**: الاسم، التصنيف
   - **معلومات الاتصال**: الهاتف، البريد، العنوان
   - **المعلومات التجارية**: الرقم الضريبي، السجل التجاري
   - **المعلومات المالية**: حد الائتمان، شروط الدفع
4. اضغط **حفظ المورد**

### إنشاء فاتورة شراء

1. انتقل إلى **المشتريات > فاتورة جديدة**
2. اختر:
   - تاريخ الفاتورة
   - المورد
   - المستودع الذي سيتم إضافة البضاعة إليه
   - رقم المرجع (اختياري)
3. أضف الأصناف:
   - اختر الصنف من القائمة
   - أدخل الكمية
   - السعر سيتم تعبئته تلقائياً (يمكن تعديله)
   - أدخل نسبة الخصم (اختياري)
   - نسبة الضريبة (افتراضياً 15%)
4. الحسابات ستتم تلقائياً
5. اضغط **حفظ الفاتورة**

**ملاحظة**: الفاتورة ستُحفظ بحالة "مسودة" ولن تؤثر على المخزون حتى يتم تأكيدها.

### تأكيد فاتورة الشراء

1. افتح الفاتورة من قائمة الفواتير
2. اضغط **تأكيد الفاتورة**
3. راجع التغييرات التي ستحدث:
   - إضافة الكميات للمخزون
   - تسجيل حركات مخزنية
   - إضافة المبلغ لرصيد المورد
4. ضع علامة على خانة التأكيد
5. اضغط **تأكيد الفاتورة**

**تنبيه**: بعد التأكيد لن تتمكن من حذف الفاتورة، يمكنك إلغاؤها فقط.

### إلغاء فاتورة مؤكدة

1. افتح الفاتورة المؤكدة
2. اضغط **إلغاء الفاتورة**
3. راجع التغييرات:
   - خصم الكميات من المخزون
   - تسجيل حركات مخزنية عكسية
   - خصم المبلغ من رصيد المورد
4. ضع علامة على خانة التأكيد
5. اضغط **إلغاء الفاتورة**

### حذف فاتورة (مسودة فقط)

1. افتح الفاتورة في حالة "مسودة"
2. اضغط **حذف**
3. أكد الحذف
4. سيتم حذف الفاتورة نهائياً

## حالات الفاتورة

### 1. مسودة (Draft)
- الفاتورة محفوظة ولكن لم يتم تأكيدها
- لا تؤثر على المخزون أو رصيد المورد
- يمكن تعديلها أو حذفها

### 2. مؤكدة (Confirmed)
- تم تأكيد الفاتورة
- تمت إضافة الكميات للمخزون
- تم تحديث رصيد المورد
- يمكن إلغاؤها ولكن لا يمكن حذفها

### 3. مدفوعة (Paid)
- تم دفع كامل المبلغ
- الفاتورة مغلقة

### 4. ملغاة (Cancelled)
- تم إلغاء الفاتورة
- تم عكس جميع التأثيرات على المخزون والحسابات

## حالات الدفع

### 1. غير مدفوعة (Unpaid)
- لم يتم دفع أي مبلغ
- المبلغ المتبقي = الإجمالي

### 2. مدفوعة جزئياً (Partial)
- تم دفع جزء من المبلغ
- المبلغ المتبقي > 0

### 3. مدفوعة (Paid)
- تم دفع كامل المبلغ
- المبلغ المتبقي = 0

## الحسابات التلقائية

### حساب سعر الصنف
```
المجموع الفرعي = الكمية × السعر
الخصم = المجموع الفرعي × (نسبة الخصم ÷ 100)
بعد الخصم = المجموع الفرعي - الخصم
الضريبة = بعد الخصم × (نسبة الضريبة ÷ 100)
الإجمالي = بعد الخصم + الضريبة
```

### حساب إجمالي الفاتورة
```
المجموع الفرعي = مجموع (الكمية × السعر) لجميع الأصناف
إجمالي الخصم = مجموع الخصومات لجميع الأصناف
إجمالي الضريبة = مجموع الضرائب لجميع الأصناف
الإجمالي النهائي = المجموع الفرعي - إجمالي الخصم + إجمالي الضريبة
```

## البحث والتصفية

### البحث في الموردين
- البحث بالاسم
- البحث بالكود
- البحث برقم الهاتف

### البحث في الفواتير
- البحث برقم الفاتورة
- التصفية حسب الحالة (مسودة، مؤكدة، مدفوعة، ملغاة)
- التصفية حسب المورد
- التصفية حسب التاريخ

## التقارير المتاحة

1. **قائمة الموردين**: عرض جميع الموردين مع أرصدتهم
2. **فواتير الشراء**: عرض جميع الفواتير مع حالاتها
3. **حركات المخزون**: تتبع جميع الحركات المرتبطة بالمشتريات
4. **أرصدة الموردين**: متابعة المديونيات

## نصائح وإرشادات

### أفضل الممارسات

1. **قبل التأكيد**:
   - تأكد من صحة جميع البيانات
   - راجع الكميات والأسعار
   - تحقق من المستودع المختار

2. **عند الإلغاء**:
   - تأكد من وجود كميات كافية في المخزون
   - راجع تأثير الإلغاء على رصيد المورد

3. **إدارة الموردين**:
   - حدد حد ائتماني مناسب لكل مورد
   - حدث بيانات الاتصال بانتظام
   - راجع الأرصدة دورياً

### تجنب الأخطاء الشائعة

1. ❌ **لا تؤكد** فاتورة قبل مراجعتها جيداً
2. ❌ **لا تلغي** فاتورة إلا للضرورة القصوى
3. ❌ **لا تحذف** بيانات الموردين المرتبطة بفواتير
4. ✅ **استخدم** حالة المسودة للفواتير قيد المراجعة
5. ✅ **راجع** الأرصدة بانتظام
6. ✅ **احتفظ** بنسخ احتياطية من البيانات

## الأمان والصلاحيات

- جميع العمليات تتطلب تسجيل دخول
- يتم تسجيل المستخدم الذي أنشأ كل فاتورة
- يتم تسجيل جميع الحركات مع التاريخ والوقت

## الدعم الفني

في حالة وجود أي مشاكل أو استفسارات:
1. راجع هذا الدليل أولاً
2. تحقق من رسائل الخطأ المعروضة
3. تواصل مع فريق الدعم الفني

---

**آخر تحديث**: 2026-01-10
**الإصدار**: 1.0

