# دليل التكامل المحاسبي

## نظرة عامة

تم إضافة نظام تكامل محاسبي متقدم يربط جميع العمليات التجارية (المبيعات، المشتريات، المدفوعات) بالحسابات المحاسبية تلقائياً.

## الميزات الرئيسية

### 1. إعدادات الحسابات المحاسبية

يمكن الوصول إلى صفحة الإعدادات من: **الإعدادات > إعدادات الحسابات**

#### حسابات المبيعات
- **حساب إيرادات المبيعات**: الحساب الذي يتم تسجيل إيرادات المبيعات فيه
- **حساب ضريبة المبيعات**: حساب الضريبة المستحقة على المبيعات
- **حساب خصم المبيعات**: حساب الخصومات الممنوحة للعملاء
- **حساب العملاء (الذمم المدينة)**: حساب المبالغ المستحقة من العملاء
- **حساب تكلفة المبيعات**: حساب تكلفة البضاعة المباعة

#### حسابات المشتريات
- **حساب مصروف المشتريات**: الحساب الذي يتم تسجيل مصروفات المشتريات فيه
- **حساب ضريبة المشتريات**: حساب الضريبة المدفوعة على المشتريات
- **حساب خصم المشتريات**: حساب الخصومات المستلمة من الموردين
- **حساب الموردين (الذمم الدائنة)**: حساب المبالغ المستحقة للموردين

#### حسابات المخزون والنقدية
- **حساب المخزون**: حساب قيمة المخزون
- **حساب تسوية المخزون**: حساب تسويات المخزون (زيادة/نقص)
- **حساب النقدية**: الحساب النقدي الرئيسي

#### حسابات نقاط البيع (POS)
- **حساب النقدية (POS)**: حساب النقدية لنقاط البيع
- **حساب البطاقات (POS)**: حساب مدفوعات البطاقات

### 2. إعدادات الأتمتة

#### إنشاء قيود محاسبية تلقائياً
عند تفعيل هذا الخيار، يتم إنشاء قيود محاسبية تلقائياً عند:
- تأكيد فواتير المبيعات
- تأكيد فواتير المشتريات
- إضافة مدفوعات/تحصيلات

#### ترحيل القيود تلقائياً
عند تفعيل هذا الخيار، يتم ترحيل القيود المحاسبية فوراً بدون الحاجة للمراجعة اليدوية.

## القيود المحاسبية التلقائية

### 1. فاتورة مبيعات

عند تأكيد فاتورة مبيعات، يتم إنشاء القيد التالي:

```
من حـ/ العملاء (الذمم المدينة)     [إجمالي الفاتورة]
    إلى حـ/ إيرادات المبيعات       [المبلغ قبل الضريبة]
    إلى حـ/ ضريبة المبيعات         [قيمة الضريبة]
```

### 2. فاتورة مشتريات

عند تأكيد فاتورة مشتريات، يتم إنشاء القيد التالي:

```
من حـ/ مصروف المشتريات           [المبلغ قبل الضريبة]
من حـ/ ضريبة المشتريات           [قيمة الضريبة]
    إلى حـ/ الموردين (الذمم الدائنة)  [إجمالي الفاتورة]
```

### 3. تحصيل من عميل

عند إضافة تحصيل من عميل، يتم إنشاء القيد التالي:

```
من حـ/ النقدية/البنك              [المبلغ المحصل]
    إلى حـ/ العملاء (الذمم المدينة)  [المبلغ المحصل]
```

### 4. دفع لمورد

عند إضافة دفع لمورد، يتم إنشاء القيد التالي:

```
من حـ/ الموردين (الذمم الدائنة)    [المبلغ المدفوع]
    إلى حـ/ النقدية/البنك          [المبلغ المدفوع]
```

## كيفية الاستخدام

### الخطوة 1: إعداد الحسابات المحاسبية

1. انتقل إلى **المحاسبة > دليل الحسابات**
2. أنشئ الحسابات المطلوبة حسب التصنيفات التالية:
   - أصول (Assets): النقدية، البنوك، العملاء، المخزون
   - خصوم (Liabilities): الموردين
   - إيرادات (Revenue): إيرادات المبيعات، خصم المشتريات
   - مصروفات (Expenses): تكلفة المبيعات، مصروف المشتريات، خصم المبيعات

### الخطوة 2: ربط الحسابات في الإعدادات

1. انتقل إلى **الإعدادات > إعدادات الحسابات**
2. اختر الحساب المناسب لكل عملية
3. فعّل خيار "إنشاء قيود محاسبية تلقائياً"
4. (اختياري) فعّل خيار "ترحيل القيود تلقائياً"
5. احفظ الإعدادات

### الخطوة 3: استخدام النظام

بعد إعداد الحسابات، سيقوم النظام تلقائياً بـ:
- إنشاء قيود محاسبية عند تأكيد الفواتير
- إنشاء قيود محاسبية عند إضافة المدفوعات
- تحديث أرصدة الحسابات تلقائياً (إذا تم تفعيل الترحيل التلقائي)

## الملفات المضافة

### Models
- `app/models_settings.py`: نموذج إعدادات الحسابات المحاسبية

### Routes
- `app/settings/routes.py`: مسارات إعدادات الحسابات المحاسبية

### Templates
- `app/templates/settings/accounting_settings.html`: صفحة إعدادات الحسابات

### Utilities
- `app/utils/accounting_helper.py`: دوال مساعدة لإنشاء القيود المحاسبية

## ملاحظات مهمة

1. **الحسابات الإلزامية**: بعض الحسابات إلزامية ويجب تحديدها قبل استخدام النظام:
   - حساب العملاء (الذمم المدينة)
   - حساب إيرادات المبيعات
   - حساب الموردين (الذمم الدائنة)
   - حساب مصروف المشتريات
   - حساب المخزون
   - حساب النقدية

2. **المراجعة**: إذا لم يتم تفعيل "الترحيل التلقائي"، ستحتاج إلى مراجعة وترحيل القيود يدوياً من صفحة القيود اليومية.

3. **معالجة الأخطاء**: إذا فشل إنشاء القيد المحاسبي، سيتم عرض تحذير ولكن لن يتم إلغاء العملية الأساسية (الفاتورة/المدفوعة).

## الدعم الفني

للمزيد من المساعدة أو الإبلاغ عن مشاكل، يرجى التواصل مع فريق الدعم الفني.

